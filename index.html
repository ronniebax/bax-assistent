<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bax Music Assistent</title>
    <link rel="icon" type="image/x-icon" href="https://storage.googleapis.com/graphics_bax/favicon.ico">
    <link rel="stylesheet" href="/webhook/bax-assistent/css/styles.css">
    <script>
        // Detect OAuth callback IMMEDIATELY before any rendering
        (function() {
            const hash = window.location.hash;
            const search = window.location.search;
            
            // Check if we're returning from OAuth or have a session
            if ((hash && hash.includes('id_token')) || (search && search.includes('session='))) {
                // Add style to hide login view from the start
                const style = document.createElement('style');
                style.textContent = '#login-view { display: none !important; }';
                document.head.appendChild(style);
            }
        })();
    </script>
</head>
<body>
    <!-- Loading State -->
    <div id="loading-view" class="loading-container">
        <div class="spinner"></div>
        <p class="loading-text">Even geduld...</p>
    </div>

    <!-- Login View -->
    <div id="login-view" class="hidden login-container">
        <div class="login-card">
            <div class="logo-container">
                <svg class="logo" viewBox="0 0 1000 1000" xmlns="http://www.w3.org/2000/svg" aria-label="Bax Music">
                    <path fill="#C30061" d="M913.1,803.2H86.9c-47.7,0-86.3-38.7-86.3-86.4V283.1c0-47.7,38.6-86.4,86.3-86.4h826.2c47.7,0,86.3,38.7,86.3,86.4v433.7C999.4,764.5,960.8,803.2,913.1,803.2"/>
                    <path fill="#FFFFFF" d="M152.4,540.7c7.1,0,14,1.1,20.7,3.4c6.7,2.2,12.9,5.7,18.6,10.4c11.3-9.2,24.5-13.8,39.6-13.8c8.2,0,16.2,1.6,23.9,4.8c7.7,3.2,14.4,7.5,20.1,12.9c5.8,5.4,10.4,11.9,13.8,19.5c3.4,7.5,5.1,15.6,5.1,24.1v88.8c0,5.7-2.4,10.6-7.1,14.9c-4.7,4.2-10.1,6.4-16.3,6.4c-6.1,0-11.5-2.3-16.1-6.9c-4.6-4.6-6.9-10-6.9-16.1V603c0-4.5-1.6-8.3-4.8-11.3c-3.2-3.1-7.1-4.6-11.8-4.6c-4,0-7.7,1.4-11.1,4.1c-3.4,2.7-5.1,6.7-5.1,11.8v85.9c0,6.4-2.3,11.8-6.9,16.3c-4.6,4.5-10.1,6.7-16.4,6.7c-5.9,0-11.2-2.1-15.9-6.2c-4.7-4.1-7.1-9.1-7.1-15V603c-0.2-4.7-2-8.5-5.3-11.5c-3.3-2.9-7-4.4-11-4.4c-4.5,0-8.3,1.5-11.5,4.6c-3.2,3.1-4.9,7-5.1,11.7V691c-0.5,5.7-2.9,10.6-7.2,14.7c-4.4,4.1-9.6,6.2-15.7,6.2c-3.3,0-6.4-0.6-9.2-1.8c-2.8-1.2-5.3-2.8-7.4-5c-2.1-2.1-3.8-4.6-5.1-7.4c-1.3-2.8-1.8-5.8-1.6-8.8v-87c0-8.3,1.6-16.1,4.9-23.5c3.3-7.4,7.8-13.9,13.4-19.5c5.7-5.5,12.3-10,20-13.3C135.5,542.4,143.7,540.7,152.4,540.7M640,540c6.4,0,11.7,2.4,15.9,7.3c4.2,4.8,6.4,10,6.4,15.4c0,6.1-2.3,11.5-6.9,16.1c-4.6,4.6-9.7,6.9-15.4,6.9h-86.9c-2.8,0-5,0.8-6.5,2.5c-1.5,1.7-2.3,3.7-2.3,6c0,2.4,0.8,4.4,2.3,6.2c1.5,1.8,3.7,2.7,6.5,2.7h60c7.3,0,14.1,1.5,20.3,4.4c6.2,3,11.7,7,16.3,12c4.6,5.1,8.2,10.8,10.8,17.3c2.6,6.5,3.9,13.3,3.9,20.3c0,8-1.4,15.4-4.2,22.1c-2.8,6.7-6.7,12.5-11.7,17.3c-4.9,4.8-10.8,8.6-17.7,11.3c-6.8,2.7-14.4,4.1-22.6,4.1h-89.4c-6.1,0-11.3-2.1-15.5-6.4c-4.2-4.2-6.4-9.7-6.4-16.3c0-5.9,2.1-11.3,6.4-16.1c4.2-4.8,9.4-7.4,15.5-7.6h89.4c6.4,0,9.5-2.8,9.5-8.5c0-5.4-3.2-8.1-9.5-8.1h-59c-7.1,0-13.7-1.5-20-4.4c-6.2-2.9-11.7-6.9-16.3-11.8c-4.6-5-8.2-10.7-10.8-17.3c-2.6-6.6-3.9-13.7-3.9-21.2c0-7.1,1.4-13.8,4.1-20.3c2.7-6.5,6.4-12.2,11.1-17.2c4.7-5,10.2-8.9,16.6-11.8c6.4-2.9,13.3-4.5,20.8-4.8H640zM702.6,541.8c6.1,0,11.2,2.2,15.4,6.7c4.1,4.5,6.4,9.9,6.9,16.3V690c0,6.4-2,11.7-6,15.9c-4,4.2-9.4,6.6-16.3,7.1c-6.1,0-11.3-1.9-15.5-5.7c-4.2-3.8-6.8-9.1-7.8-15.9v-128c0.5-6.1,2.9-11.2,7.4-15.2C691.2,544.1,696.5,542,702.6,541.8"/>
                    <path d="M761.6,518.3h-1.2c-12.2,0-22.2-9.9-22.2-22.2V369.8c0-12.2,9.9-22.2,22.2-22.2h1.2c12.2,0,22.2,9.9,22.2,22.2v126.3C783.8,508.3,773.9,518.3,761.6,518.3M842.7,496.1v-65.5c0-12.2-9.9-22.2-22.2-22.2h-1.2c-12.2,0-22.2,9.9-22.2,22.2v65.5c0,12.2,9.9,22.2,22.2,22.2h1.2C832.8,518.3,842.7,508.3,842.7,496.1M724.9,495.6v-13.9c0-12.5-10.2-22.7-22.7-22.7H702c-12.5,0-22.7,10.2-22.7,22.7v13.9c0,12.5,10.2,22.7,22.7,22.7h0.2C714.7,518.3,724.9,508.1,724.9,495.6M901.6,496.1V394.5c0-12.2-9.9-22.2-22.2-22.2h-1.2c-12.2,0-22.2,9.9-22.2,22.2v101.6c0,12.2,9.9,22.2,22.2,22.2h1.2C891.7,518.3,901.6,508.3,901.6,496.1"/>
                    <path fill="#FFFFFF" d="M334.7,540.4c6.1,0,11.5,2.3,16.3,6.9c4.7,4.6,7.1,10.2,7.1,16.8v62.2c0,5.4,1.1,10.6,3.2,15.4c2.1,4.8,4.9,9,8.5,12.6c3.5,3.5,7.7,6.4,12.5,8.5c4.8,2.1,9.9,3.2,15.4,3.2c5.2,0,10.1-0.9,14.8-2.8c4.7-1.9,8.9-4.5,12.5-7.8c3.7-3.3,6.5-7.3,8.7-12c2.1-4.7,3.2-9.8,3.2-15.2v-64.4c0-4.7,1.2-8.7,3.5-12c0.5-0.7,1-1.4,1.6-2.1c0.6-0.7,1.2-1.4,1.9-2.1c4.2-4.7,9.5-7.1,15.9-7.1c6.4,0,11.9,2.4,16.6,7.1c4.5,4.5,6.8,9.5,7.1,15.2v63.7c0,11.8-2.2,22.9-6.7,33.2c-4.5,10.4-10.6,19.5-18.4,27.2c-7.8,7.8-16.8,13.9-27.2,18.4c-10.4,4.5-21.6,6.7-33.6,6.7c-11.3,0.5-22.1-1.5-32.5-5.8c-10.4-4.4-19.5-10.4-27.4-18c-7.9-7.7-14.2-16.6-18.9-26.9c-4.7-10.3-7.1-21-7.1-32.4v-65.1c0-6.1,2.2-11.5,6.5-16.1C322.7,543,328.1,540.6,334.7,540.4M910.6,563.2c0,6.1-2.3,11.5-6.9,16.3c-4.6,4.7-10.2,7.1-16.8,7.1h-62.2c-5.4,0-10.5,1.1-15.4,3.2c-4.8,2.1-9,5-12.5,8.5c-3.5,3.5-6.4,7.7-8.5,12.6c-2.1,4.8-3.2,10-3.2,15.4c0,5.2,0.9,10.1,2.8,14.9c1.9,4.7,4.5,8.9,7.8,12.6c3.3,3.7,7.3,6.5,12,8.7c4.7,2.1,9.8,3.2,15.2,3.2h64.3c4.7,0,8.7,1.2,12,3.5c0.7,0.5,1.4,1,2.1,1.6c0.7,0.6,1.4,1.2,2.1,1.9c4.7,4.2,7.1,9.5,7.1,15.9c0,6.4-2.4,11.9-7.1,16.6c-4.5,4.5-9.5,6.8-15.2,7.1h-63.6c-11.8,0-22.9-2.2-33.2-6.7c-10.4-4.5-19.4-10.6-27.2-18.4c-7.8-7.8-13.9-16.9-18.4-27.2c-4.5-10.4-6.7-21.6-6.7-33.6c-0.5-11.3,1.5-22.2,5.8-32.5c4.4-10.4,10.4-19.5,18-27.4c7.7-7.9,16.6-14.2,26.9-18.9c10.2-4.7,21-7.1,32.3-7.1h65c6.1,0,11.5,2.2,16.1,6.5C907.9,551.1,910.3,556.6,910.6,563.2M473.5,353.1c-1.8-1.6-3.8-3-5.9-4c-2.8-1.4-5.7-2.3-8.9-2.4h-67.2c-11.8,0-22.9,2.2-33.2,6.7c-10.4,4.5-19.4,10.6-27.2,18.4c-7.8,7.8-13.9,16.9-18.4,27.2c-4.5,10.4-6.7,21.6-6.7,33.6c-0.5,11.3,1.5,22.2,5.8,32.5c4.4,10.4,10.4,19.5,18,27.4c7.7,7.9,16.6,14.2,26.9,18.9c10.2,4.7,21,7.1,32.3,7.1h68.6c6.1,0,11.3-1.9,15.5-5.7c2.4-2.1,4.2-4.8,5.6-7.9c0.1-0.3,0.3-0.6,0.4-0.9c0-0.1,0.1-0.2,0.1-0.2c0.5-1.3,1-2.8,1.2-4.2c0.2-0.9,0.3-1.8,0.5-2.7V368.3C480.4,362.2,477.9,357.1,473.5,353.1M376,469.1c-4.8-2.1-9-5-12.5-8.5c-3.5-3.5-6.4-7.7-8.5-12.6c-2.1-4.8-3.2-10-3.2-15.4c0-5.2,0.9-10.1,2.8-14.9c1.9-4.7,4.5-8.9,7.8-12.6c3.3-3.7,7.3-6.5,12-8.7c4.7-2.1,9.8-3.2,15.2-3.2h45.7v78.9h-43.9C386,472.3,380.8,471.2,376,469.1M657.3,478.4l-42.5-45.6l43.5-46.7c4.1-5.9,5.9-11.8,5.4-17.7c-0.6-5.9-3.2-11-7.8-15.4c-5.5-4.5-11.3-6.6-17.4-6.2c-6.1,0.4-11.4,3-15.9,7.9l-40.2,43.2l-40.2-43.2c-4.9-4.5-10.5-7-16.8-7.5c-6.3-0.5-11.8,1.5-16.5,5.8c-4.5,4.5-7,9.9-7.6,16.2c-0.6,6.2,1.2,11.9,5.1,16.9l43.5,46.7l-42.5,45.6c-4.2,5.2-6.3,11-6.3,17.3c0,6.3,2.3,11.7,6.9,16.1c4.8,4.2,10.4,6.3,16.6,6.5c6.3,0.1,11.7-2,16.5-6.3l41.2-44.2l41.2,44.2c5.6,4.5,11.3,6.7,17.2,6.6c5.9-0.1,11.2-2.4,15.9-6.7c4.9-5.2,7.3-10.9,7.4-17C664.1,488.7,661.8,483.2,657.3,478.4M287.8,432.4c0-12-2.2-23.2-6.7-33.6c-4.5-10.4-10.6-19.5-18.4-27.2c-7.8-7.8-16.8-13.9-27.2-18.4c-10.4-4.5-21.4-6.7-33.2-6.7h-57.8v-42.5c-0.5-6.4-2.8-11.8-6.9-16.3c-4.1-4.5-9.2-6.7-15.4-6.7c-6.1,0.2-11.4,2.4-15.9,6.4c-4.5,4-7,9.1-7.4,15.2v194.3c0.1,0.9,0.3,1.8,0.5,2.7c0.3,1.5,0.7,2.9,1.2,4.2c0,0.1,0.1,0.2,0.1,0.2c0.1,0.3,0.2,0.6,0.4,0.9c1.3,3.1,3.2,5.8,5.6,7.9c4.2,3.8,9.4,5.7,15.5,5.7h82.5c11.3,0,22.1-2.4,32.3-7.1c10.2-4.7,19.2-11,26.9-18.9c7.7-7.9,13.7-17,18-27.4C286.4,454.6,288.3,443.7,287.8,432.4M238.7,447.8c-2.1,4.8-4.9,9-8.5,12.6c-3.5,3.5-7.7,6.4-12.5,8.5c-4.8,2.1-9.9,3.2-15.4,3.2h-57.8v-78.9h59.5c5.4,0,10.5,1.1,15.2,3.2c4.7,2.1,8.7,5,12,8.7c3.3,3.7,5.9,7.8,7.8,12.6c1.9,4.7,2.8,9.7,2.8,14.9C241.9,437.8,240.8,443,238.7,447.8"/>
                </svg>
            </div>

            <h1 class="login-title">Bax Music Assistent</h1>
            <h2 class="login-subtitle">AI Chat Assistant</h2>
            <p class="login-description">
                Log in met je Bax Music Google account om toegang te krijgen tot de chat assistent.
            </p>

            <button onclick="window.auth.startGoogleLogin()" class="google-btn">
                <svg viewBox="0 0 24 24">
                    <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                    <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                    <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                    <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                </svg>
                Inloggen met Google
            </button>

            <div id="login-error" class="error-message hidden"></div>

            <div class="login-footer">
                <p>Alleen toegankelijk voor geautoriseerde @bax-shop.nl accounts</p>
            </div>
        </div>
    </div>

    <!-- App View -->
    <div id="app-view" class="hidden">
        <!-- Header -->
        <header class="app-header">
            <div class="header-content">
                <div class="header-brand">
                    <svg class="header-logo" viewBox="0 0 1000 1000" xmlns="http://www.w3.org/2000/svg" aria-label="Bax Music">
                        <path fill="#C30061" d="M913.1,803.2H86.9c-47.7,0-86.3-38.7-86.3-86.4V283.1c0-47.7,38.6-86.4,86.3-86.4h826.2c47.7,0,86.3,38.7,86.3,86.4v433.7C999.4,764.5,960.8,803.2,913.1,803.2"/>
                        <path fill="#FFFFFF" d="M152.4,540.7c7.1,0,14,1.1,20.7,3.4c6.7,2.2,12.9,5.7,18.6,10.4c11.3-9.2,24.5-13.8,39.6-13.8c8.2,0,16.2,1.6,23.9,4.8c7.7,3.2,14.4,7.5,20.1,12.9c5.8,5.4,10.4,11.9,13.8,19.5c3.4,7.5,5.1,15.6,5.1,24.1v88.8c0,5.7-2.4,10.6-7.1,14.9c-4.7,4.2-10.1,6.4-16.3,6.4c-6.1,0-11.5-2.3-16.1-6.9c-4.6-4.6-6.9-10-6.9-16.1V603c0-4.5-1.6-8.3-4.8-11.3c-3.2-3.1-7.1-4.6-11.8-4.6c-4,0-7.7,1.4-11.1,4.1c-3.4,2.7-5.1,6.7-5.1,11.8v85.9c0,6.4-2.3,11.8-6.9,16.3c-4.6,4.5-10.1,6.7-16.4,6.7c-5.9,0-11.2-2.1-15.9-6.2c-4.7-4.1-7.1-9.1-7.1-15V603c-0.2-4.7-2-8.5-5.3-11.5c-3.3-2.9-7-4.4-11-4.4c-4.5,0-8.3,1.5-11.5,4.6c-3.2,3.1-4.9,7-5.1,11.7V691c-0.5,5.7-2.9,10.6-7.2,14.7c-4.4,4.1-9.6,6.2-15.7,6.2c-3.3,0-6.4-0.6-9.2-1.8c-2.8-1.2-5.3-2.8-7.4-5c-2.1-2.1-3.8-4.6-5.1-7.4c-1.3-2.8-1.8-5.8-1.6-8.8v-87c0-8.3,1.6-16.1,4.9-23.5c3.3-7.4,7.8-13.9,13.4-19.5c5.7-5.5,12.3-10,20-13.3C135.5,542.4,143.7,540.7,152.4,540.7M640,540c6.4,0,11.7,2.4,15.9,7.3c4.2,4.8,6.4,10,6.4,15.4c0,6.1-2.3,11.5-6.9,16.1c-4.6,4.6-9.7,6.9-15.4,6.9h-86.9c-2.8,0-5,0.8-6.5,2.5c-1.5,1.7-2.3,3.7-2.3,6c0,2.4,0.8,4.4,2.3,6.2c1.5,1.8,3.7,2.7,6.5,2.7h60c7.3,0,14.1,1.5,20.3,4.4c6.2,3,11.7,7,16.3,12c4.6,5.1,8.2,10.8,10.8,17.3c2.6,6.5,3.9,13.3,3.9,20.3c0,8-1.4,15.4-4.2,22.1c-2.8,6.7-6.7,12.5-11.7,17.3c-4.9,4.8-10.8,8.6-17.7,11.3c-6.8,2.7-14.4,4.1-22.6,4.1h-89.4c-6.1,0-11.3-2.1-15.5-6.4c-4.2-4.2-6.4-9.7-6.4-16.3c0-5.9,2.1-11.3,6.4-16.1c4.2-4.8,9.4-7.4,15.5-7.6h89.4c6.4,0,9.5-2.8,9.5-8.5c0-5.4-3.2-8.1-9.5-8.1h-59c-7.1,0-13.7-1.5-20-4.4c-6.2-2.9-11.7-6.9-16.3-11.8c-4.6-5-8.2-10.7-10.8-17.3c-2.6-6.6-3.9-13.7-3.9-21.2c0-7.1,1.4-13.8,4.1-20.3c2.7-6.5,6.4-12.2,11.1-17.2c4.7-5,10.2-8.9,16.6-11.8c6.4-2.9,13.3-4.5,20.8-4.8H640zM702.6,541.8c6.1,0,11.2,2.2,15.4,6.7c4.1,4.5,6.4,9.9,6.9,16.3V690c0,6.4-2,11.7-6,15.9c-4,4.2-9.4,6.6-16.3,7.1c-6.1,0-11.3-1.9-15.5-5.7c-4.2-3.8-6.8-9.1-7.8-15.9v-128c0.5-6.1,2.9-11.2,7.4-15.2C691.2,544.1,696.5,542,702.6,541.8"/>
                        <path d="M761.6,518.3h-1.2c-12.2,0-22.2-9.9-22.2-22.2V369.8c0-12.2,9.9-22.2,22.2-22.2h1.2c12.2,0,22.2,9.9,22.2,22.2v126.3C783.8,508.3,773.9,518.3,761.6,518.3M842.7,496.1v-65.5c0-12.2-9.9-22.2-22.2-22.2h-1.2c-12.2,0-22.2,9.9-22.2,22.2v65.5c0,12.2,9.9,22.2,22.2,22.2h1.2C832.8,518.3,842.7,508.3,842.7,496.1M724.9,495.6v-13.9c0-12.5-10.2-22.7-22.7-22.7H702c-12.5,0-22.7,10.2-22.7,22.7v13.9c0,12.5,10.2,22.7,22.7,22.7h0.2C714.7,518.3,724.9,508.1,724.9,495.6M901.6,496.1V394.5c0-12.2-9.9-22.2-22.2-22.2h-1.2c-12.2,0-22.2,9.9-22.2,22.2v101.6c0,12.2,9.9,22.2,22.2,22.2h1.2C891.7,518.3,901.6,508.3,901.6,496.1"/>
                        <path fill="#FFFFFF" d="M334.7,540.4c6.1,0,11.5,2.3,16.3,6.9c4.7,4.6,7.1,10.2,7.1,16.8v62.2c0,5.4,1.1,10.6,3.2,15.4c2.1,4.8,4.9,9,8.5,12.6c3.5,3.5,7.7,6.4,12.5,8.5c4.8,2.1,9.9,3.2,15.4,3.2c5.2,0,10.1-0.9,14.8-2.8c4.7-1.9,8.9-4.5,12.5-7.8c3.7-3.3,6.5-7.3,8.7-12c2.1-4.7,3.2-9.8,3.2-15.2v-64.4c0-4.7,1.2-8.7,3.5-12c0.5-0.7,1-1.4,1.6-2.1c0.6-0.7,1.2-1.4,1.9-2.1c4.2-4.7,9.5-7.1,15.9-7.1c6.4,0,11.9,2.4,16.6,7.1c4.5,4.5,6.8,9.5,7.1,15.2v63.7c0,11.8-2.2,22.9-6.7,33.2c-4.5,10.4-10.6,19.5-18.4,27.2c-7.8,7.8-16.8,13.9-27.2,18.4c-10.4,4.5-21.6,6.7-33.6,6.7c-11.3,0.5-22.1-1.5-32.5-5.8c-10.4-4.4-19.5-10.4-27.4-18c-7.9-7.7-14.2-16.6-18.9-26.9c-4.7-10.3-7.1-21-7.1-32.4v-65.1c0-6.1,2.2-11.5,6.5-16.1C322.7,543,328.1,540.6,334.7,540.4M910.6,563.2c0,6.1-2.3,11.5-6.9,16.3c-4.6,4.7-10.2,7.1-16.8,7.1h-62.2c-5.4,0-10.5,1.1-15.4,3.2c-4.8,2.1-9,5-12.5,8.5c-3.5,3.5-6.4,7.7-8.5,12.6c-2.1,4.8-3.2,10-3.2,15.4c0,5.2,0.9,10.1,2.8,14.9c1.9,4.7,4.5,8.9,7.8,12.6c3.3,3.7,7.3,6.5,12,8.7c4.7,2.1,9.8,3.2,15.2,3.2h64.3c4.7,0,8.7,1.2,12,3.5c0.7,0.5,1.4,1,2.1,1.6c0.7,0.6,1.4,1.2,2.1,1.9c4.7,4.2,7.1,9.5,7.1,15.9c0,6.4-2.4,11.9-7.1,16.6c-4.5,4.5-9.5,6.8-15.2,7.1h-63.6c-11.8,0-22.9-2.2-33.2-6.7c-10.4-4.5-19.4-10.6-27.2-18.4c-7.8-7.8-13.9-16.9-18.4-27.2c-4.5-10.4-6.7-21.6-6.7-33.6c-0.5-11.3,1.5-22.2,5.8-32.5c4.4-10.4,10.4-19.5,18-27.4c7.7-7.9,16.6-14.2,26.9-18.9c10.2-4.7,21-7.1,32.3-7.1h65c6.1,0,11.5,2.2,16.1,6.5C907.9,551.1,910.3,556.6,910.6,563.2M473.5,353.1c-1.8-1.6-3.8-3-5.9-4c-2.8-1.4-5.7-2.3-8.9-2.4h-67.2c-11.8,0-22.9,2.2-33.2,6.7c-10.4,4.5-19.4,10.6-27.2,18.4c-7.8,7.8-13.9,16.9-18.4,27.2c-4.5,10.4-6.7,21.6-6.7,33.6c-0.5,11.3,1.5,22.2,5.8,32.5c4.4,10.4,10.4,19.5,18,27.4c7.7,7.9,16.6,14.2,26.9,18.9c10.2,4.7,21,7.1,32.3,7.1h68.6c6.1,0,11.3-1.9,15.5-5.7c2.4-2.1,4.2-4.8,5.6-7.9c0.1-0.3,0.3-0.6,0.4-0.9c0-0.1,0.1-0.2,0.1-0.2c0.5-1.3,1-2.8,1.2-4.2c0.2-0.9,0.3-1.8,0.5-2.7V368.3C480.4,362.2,477.9,357.1,473.5,353.1M376,469.1c-4.8-2.1-9-5-12.5-8.5c-3.5-3.5-6.4-7.7-8.5-12.6c-2.1-4.8-3.2-10-3.2-15.4c0-5.2,0.9-10.1,2.8-14.9c1.9-4.7,4.5-8.9,7.8-12.6c3.3-3.7,7.3-6.5,12-8.7c4.7-2.1,9.8-3.2,15.2-3.2h45.7v78.9h-43.9C386,472.3,380.8,471.2,376,469.1M657.3,478.4l-42.5-45.6l43.5-46.7c4.1-5.9,5.9-11.8,5.4-17.7c-0.6-5.9-3.2-11-7.8-15.4c-5.5-4.5-11.3-6.6-17.4-6.2c-6.1,0.4-11.4,3-15.9,7.9l-40.2,43.2l-40.2-43.2c-4.9-4.5-10.5-7-16.8-7.5c-6.3-0.5-11.8,1.5-16.5,5.8c-4.5,4.5-7,9.9-7.6,16.2c-0.6,6.2,1.2,11.9,5.1,16.9l43.5,46.7l-42.5,45.6c-4.2,5.2-6.3,11-6.3,17.3c0,6.3,2.3,11.7,6.9,16.1c4.8,4.2,10.4,6.3,16.6,6.5c6.3,0.1,11.7-2,16.5-6.3l41.2-44.2l41.2,44.2c5.6,4.5,11.3,6.7,17.2,6.6c5.9-0.1,11.2-2.4,15.9-6.7c4.9-5.2,7.3-10.9,7.4-17C664.1,488.7,661.8,483.2,657.3,478.4M287.8,432.4c0-12-2.2-23.2-6.7-33.6c-4.5-10.4-10.6-19.5-18.4-27.2c-7.8-7.8-16.8-13.9-27.2-18.4c-10.4-4.5-21.4-6.7-33.2-6.7h-57.8v-42.5c-0.5-6.4-2.8-11.8-6.9-16.3c-4.1-4.5-9.2-6.7-15.4-6.7c-6.1,0.2-11.4,2.4-15.9,6.4c-4.5,4-7,9.1-7.4,15.2v194.3c0.1,0.9,0.3,1.8,0.5,2.7c0.3,1.5,0.7,2.9,1.2,4.2c0,0.1,0.1,0.2,0.1,0.2c0.1,0.3,0.2,0.6,0.4,0.9c1.3,3.1,3.2,5.8,5.6,7.9c4.2,3.8,9.4,5.7,15.5,5.7h82.5c11.3,0,22.1-2.4,32.3-7.1c10.2-4.7,19.2-11,26.9-18.9c7.7-7.9,13.7-17,18-27.4C286.4,454.6,288.3,443.7,287.8,432.4M238.7,447.8c-2.1,4.8-4.9,9-8.5,12.6c-3.5,3.5-7.7,6.4-12.5,8.5c-4.8,2.1-9.9,3.2-15.4,3.2h-57.8v-78.9h59.5c5.4,0,10.5,1.1,15.2,3.2c4.7,2.1,8.7,5,12,8.7c3.3,3.7,5.9,7.8,7.8,12.6c1.9,4.7,2.8,9.7,2.8,14.9C241.9,437.8,240.8,443,238.7,447.8"/>
                    </svg>
                    <div>
                        <h1 class="header-title">Bax Music Assistent</h1>
                        <p class="header-subtitle">AI Chat Assistent</p>
                    </div>
                </div>
                
                <div class="user-info">
                    <div class="user-details">
                        <div id="user-name" class="user-name"></div>
                        <div id="user-email" class="user-email"></div>
                    </div>
                    <img id="user-avatar" class="user-avatar" src="" alt="User">
                    <button id="debug-toggle-btn" class="debug-toggle-btn" title="Toon agent activiteit">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="16 18 22 12 16 6"></polyline>
                            <polyline points="8 6 2 12 8 18"></polyline>
                        </svg>
                    </button>
                    <button onclick="window.auth.logout()" class="logout-btn">Uitloggen</button>
                </div>
            </div>
        </header>

        <!-- Chat Container -->
        <main class="chat-container">
            <!-- Messages Area -->
            <div id="messages-area" class="messages-area">
                <!-- Welcome Message -->
                <div class="welcome-message">
                    <div class="welcome-icon">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"/>
                        </svg>
                    </div>
                    <h2 id="welcome-title" class="welcome-title">Welkom bij Bax jouw Music Assistent</h2>
                    <p class="welcome-text">Stel een vraag of wees creatief</p>
                </div>
            </div>

            <!-- Input Area -->
            <div class="input-area">
                <div class="input-container">
                    <textarea
                        id="message-input"
                        class="message-input"
                        placeholder="Typ je bericht..."
                    ></textarea>
                    <button id="send-button" class="send-button" disabled>
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 5v14M6 11l6-6 6 6"/>
                        </svg>
                    </button>
                </div>
                <div class="input-hint">
                    <span class="hint-text">Shift + Enter voor nieuwe regel</span>
                </div>
            </div>
        </main>
    </div>

    <!-- Debug Panel -->
    <div id="debug-panel" class="debug-panel">
        <div class="debug-panel-header">
            <h3 class="debug-panel-title">Agent Activiteit</h3>
            <button id="close-debug-panel" class="debug-panel-close" aria-label="Sluiten">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M18 6L6 18M6 6l12 12"></path>
                </svg>
            </button>
        </div>
        <div class="debug-panel-content">
            <div id="debug-panel-empty" class="debug-panel-empty">
                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="16 18 22 12 16 6"></polyline>
                    <polyline points="8 6 2 12 8 18"></polyline>
                </svg>
                <p>Geen activiteit om weer te geven</p>
                <p class="debug-panel-empty-hint">Stel een vraag aan de agent om zijn activiteit te zien</p>
            </div>
            <div id="debug-panel-loading" class="debug-panel-loading hidden">
                <div class="loading-spinner"></div>
                <p>Agent activiteit ophalen...</p>
            </div>
            <div id="debug-panel-data" class="debug-panel-data hidden">
                <!-- Activity data will be dynamically inserted here -->
            </div>
        </div>
    </div>

    <!-- Feedback Modal -->
    <div id="feedback-modal" class="feedback-modal">
        <div class="feedback-modal-content">
            <button id="close-feedback-modal" class="feedback-modal-close" aria-label="Sluiten">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M18 6L6 18M6 6l12 12"></path>
                </svg>
            </button>
            <h3 class="feedback-modal-title">Bedankt voor je feedback!</h3>
            <p class="feedback-modal-description">Wil je ons vertellen wat er beter kan? Dit helpt ons de assistent te verbeteren.</p>
            <textarea
                id="feedback-comment"
                class="feedback-modal-textarea"
                placeholder="Typ hier je toelichting..."
                rows="4"
            ></textarea>
            <div class="feedback-modal-buttons">
                <button id="skip-feedback" class="feedback-modal-btn feedback-modal-btn-secondary">Overslaan</button>
                <button id="submit-feedback" class="feedback-modal-btn feedback-modal-btn-primary">Verstuur toelichting</button>
            </div>
        </div>
    </div>

    <!-- Markdown parser -->
    <script src="https://cdn.jsdelivr.net/npm/marked@11.1.1/marked.min.js"></script>

    <script type="module">
        // Import modules
        import { CONFIG } from '/webhook/bax-assistent/js/config.js';
        import { initAuth, startGoogleLogin, logout, setupOAuthCallback } from '/webhook/bax-assistent/js/auth.js';
        import { initChat } from '/webhook/bax-assistent/js/chat.js';
        import { initDebugPanel } from '/webhook/bax-assistent/js/debug.js';

        // Setup OAuth callback handler
        setupOAuthCallback();

        // Make globally available for onclick handlers
        window.auth = {
            startGoogleLogin,
            logout
        };

        window.CONFIG = CONFIG;

        // Initialize app
        document.addEventListener('DOMContentLoaded', async () => {
            const authenticated = await initAuth();

            // Initialize n8n embedded chat if authenticated
            if (authenticated) {
                initChat();
                initDebugPanel();
            }
        });
    </script>
</body>
</html>
